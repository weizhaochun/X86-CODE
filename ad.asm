	DAT	BIT	P3.2
	CLK	BIT	P3.3
	CS	BIT	P3.4
	BUZZ	BIT	P3.1
	ORG	0000H
	LJMP	0100H
	ORG	001BH
	LJMP	INT_T1
	ORG	0100H
START:	MOV	SP,#60H
	SETB	DAT
	MOV	TMOD,#10H
	MOV	TL1,#033H
	MOV	TH1,#0FEH
	SETB	ET1
	SETB	EA

LOOP:	MOV	R0,#00H
	MOV	R1,#00H
	MOV	R2,#00H
	
L1:	LCALL	TLC549_ADC
	ADD	A,R1
	MOV	R1,A
	MOV	A,#00H
	ADDC	A,R2
	MOV	R2,A
	DJNZ	R6,L1
	MOV	A,R2

	LCALL	DISP
	CPL	A
	CJNE	R5,#7FH,L2
L2:	JC	L3
	SETB	TR1
	SJMP	LOOP
L3:	CLR	TR1
	SETB	BUZZ	
	LJMP	LOOP

TLC549_ADC:
	PUSH	07H
	CLR	A
	SETB	CS
	CLR	CLK		;设为空闲状态
	MOV	R7,#08H		;8位数据
	CLR	CS
	NOP
	NOP
LOOP1:	SETB	CLK
	MOV	C,DAT
	RLC	A
	CLR	CLK
	DJNZ	R7,LOOP1
	SETB	CS
	CLR	CLK
	POP	07H
	RET
DELAY:	PUSH	00H
	PUSH	01H
	MOV	R0,#80H
DELAY1:	MOV	R1,#07H
	DJNZ	R1,$
	DJNZ	R0,DELAY1
	POP	01H
	POP	00H
	RET

INT_T1:
	MOV	TL1,#033H
	MOV	TH1,#0FEH
	CPL	BUZZ
	RETI

DISP:	PUSH	ACC
	MOV		DPTR,#LEDSEG
	MOV		B,#0AH
	DIV		AB
	MOV		R2,B
	MOV		B,#0AH
	DIV		AB
	MOV		R4,B
	MOV		B,#0AH
	DIV		AB
	MOV		R3,B
	MOV		B,#0AH
	DIV		AB
	MOV		R0,B
	MOV		P1,#11110111B
	MOV		A,R0
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		P1,#11111011B
	MOV		A,R3
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		P1,#11111101B
	MOV		A,R4
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		P1,#11111110B
	MOV		A,R2
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	POP		ACC
	RET

LEDSEG:	DB	03H,9FH,25H,0DH,99H,49H,41H,1BH,01H,09H,11H,0C1H,63H,85H,61H,71H

	END