	TEMPER_L	EQU	36H
	TEMPER_H	EQU	35H
	TEMPER		EQU	34H
	TEMPER_NUM	EQU	60H
	FLAG1		BIT	00H
	DQ		BIT	P3.3

	ORG	0000H
	LJMP	MAIN
	ORG	0100H
MAIN:	MOV	SP,#70H
LP1:	LCALL	GET_TEMPER
	LCALL	TEMPER_COV
	MOV	A,TEMPER
	LCALL	DISP
	LCALL	DELAY
	SJMP	LP1
	
GET_TEMPER:
	SETB	DQ
BCD:	LCALL	INIT_1820
	JB	FLAG1,S22
	LJMP	BCD
S22:	LCALL	DELAY1
	MOV	A,#0CCH
	LCALL	WRITE_1820
	MOV	A,#44H
	LCALL	WRITE_1820
	LCALL	DELAY
CBA:	LCALL	INIT_1820
	JB	FLAG1,ABC
	LJMP	CBA
ABC:	LCALL	DELAY1
	MOV	A,#0CCH
	LCALL	WRITE_1820
	MOV	A,#0BEH
	LCALL	WRITE_1820
	LCALL	READ_1820
	RET

WRITE_1820:
	MOV	R2,#8
	CLR	C
WR1:	CLR	DQ
	MOV	R3,#7
	DJNZ	R3,$
	RRC	A
	MOV	DQ,C
	MOV	R3,#15H
	DJNZ	R3,$
	SETB	DQ
	NOP
	DJNZ	R2,WR1
	SETB	DQ
	RET

READ_1820:
	PUSH	02H
	PUSH	04H
	MOV	R4,#2
	MOV	R1,#36H
RE00:	MOV	R2,#8
RE01:	CLR	C
	SETB	DQ
	NOP
	CLR	DQ
	NOP
	NOP
	NOP
	NOP
	NOP
	SETB	DQ
	MOV	R3,#5
	DJNZ	R3,$
	MOV	C,DQ
	MOV	R3,#1CH
	DJNZ	R3,$
	RRC	A
	DJNZ	R2,RE01
	MOV	@R1,A
	DEC	R1
	DJNZ	R4,RE00
	POP	04H
	POP	02H
	RET
	
TEMPER_COV:
	MOV	A,#0F0H
	ANL	A,TEMPER_L
	SWAP	A
	MOV	TEMPER_NUM,A
	MOV	A,TEMPER_L
	ANL	A,#0FH
	MOV	B,#0AH
	DIV	AB
	MOV	R7,B
	MOV	A,TEMPER_L
	JNB	ACC.3,TEMPER_COV1
	JNB	ACC.2,LOOP2
	JMP	TEMPER_COV1
LOOP2:	JNB	ACC.1,TEMPER_COV1
	INC	TEMPER_NUM

TEMPER_COV1:
	MOV	A,TEMPER_H
	ANL	A,#07H
	SWAP	A
	ADD	A,TEMPER_NUM
	MOV	TEMPER_NUM,A
	MOV	R6,TEMPER_NUM
	RET

INIT_1820:
	SETB	DQ
	NOP
	CLR	DQ
	MOV	R0,#0ECH
TSR1:	DJNZ	R0,TSR1
	SETB	DQ
	MOV	R0,#1CH
TSR2:	DJNZ	R0,TSR2
	JNB	DQ,TSR3
	LJMP	TSR4
TSR3:	SETB	FLAG1
	LJMP	TSR5
TSR4:	CLR	FLAG1
	LJMP	TSR7
TSR5:	MOV	R0,#0E0H
TSR6:	DJNZ	R0,TSR6
TSR7:	SETB	DQ
	RET
	
DELAY1:	PUSH	07H
	MOV	R7,#20H
	DJNZ	R7,$
	POP	07H
	RET

DELAY:	PUSH	00H
	PUSH	01H
	MOV	R0,#05H
LP:	MOV	R1,#00H
	DJNZ	R1,$
	DJNZ	R0,LP
	POP	01H
	POP	00H
	RET

DISP:	PUSH	ACC
	MOV	A,R7
	MOV		DPTR,#LEDSEG
	MOV		B,#0AH
	DIV		AB
	MOV		R2,B
	MOV	A,R6
	MOV		B,#0AH
	DIV		AB
	MOV		R4,B
	MOV		B,#0AH
	DIV		AB
	MOV		R3,B
	MOV		B,#0AH
	DIV		AB
	MOV		R0,B
	MOV		P1,#11110111B
	MOV		A,R0
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		P1,#11111011B
	MOV		A,R3
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		DPTR,#LEDSEG1
	MOV		P1,#11111101B
	MOV		A,R4
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		DPTR,#LEDSEG
	MOV		P1,#11111110B
	MOV		A,R2
	MOVC	A,@A+DPTR
	MOV		P0,A
	LCALL	DELAY
	MOV		P1,#11111111B
	POP		ACC
	RET

LEDSEG:	DB	03H,9FH,25H,0DH,99H,49H,41H,1BH,01H,09H,11H,0C1H,63H,85H,61H,71H
LEDSEG1:DB 	02H,9EH,24H,0CH,98H,48H,40H,1AH,00H,08H,10H,0C0H,62H,84H,60H,70H

	END
